{% extends 'base.html' %}

{% block content %}
<form method="post" name="chart">
    <link rel="stylesheet" type="text/css" href="/static/css/summary.css">
    <div id="combobox">
        <p style="font-size:16px; font-weight: bold; color: green;">График расходов по категориям за:
            <select id="select_type" name="type_history">
            {% if type_history == "Месяц": %}
                    <option value="Сутки"> Сутки</option>
                    <option value="Месяц" selected> Месяц</option>
                    <option value="Год"> Год</option>
            {% endif %}
            {% if type_history == "Год": %}
                    <option value="Сутки"> Сутки</option>
                    <option value="Месяц"> Месяц</option>
                    <option value="Год" selected> Год</option>
            {% endif %}
            {% if type_history == "Сутки": %}
                    <option value="Сутки" selected> Сутки</option>
                    <option value="Месяц"> Месяц</option>
                    <option value="Год"> Год</option>
            {% endif %}
            </select>
            <button type="submit" class="btn btn-success">Вывести</button>
        </p>
        <p>
            <button name="left" value="-1" class="button_radius"> <img src="/static/left.png" width="18" height="18"> </button>
            {% if type_history == "Сутки": %}
                Дата расходов: <input type="date" id="start" name="dt_start" value="{{st_date}}" required >
            {% endif %}
            {% if type_history == "Месяц": %}
                Месяц:
                <select id="select_name_month" name="select_name_month">
                    {% for month in months: %}
                        {% if month == select_name_month: %}
                            <option value="{{month}}" selected>{{month}}</option>
                        {% else %}
                            <option value="{{month}}">{{month}}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            {% endif %}
            {% if type_history != "Сутки": %}
                Год:
                <input type="number" name="year" min="2015" value="{{year}}">
            {% endif %}

            <button name="right" value="+1" class="button_radius"> <img src="/static/right.png" width="18" height="18"> </button>

            {% if type_history == "Месяц": %}
                <button name="current_month" value="current_month"> Текущий месяц </button>
            {% endif %}

            {% if type_history == "Год": %}
                <button name="current_year" value="current_year"> Текущий год </button>
            {% endif %}

            {% if type_history == "Сутки": %}
                <button name="current_day" value="current_day"> Сегодня </button>
            {% endif %}
        </p>
    </div>

    <p style="color: red; text-align: center">   Структура расходов по категориям (в %)</p>
    <!-- bar chart canvas element -->
    <canvas id="myChart" width="500" height="300"></canvas>
    <p></p>
    <p id="caption", style="color: green; text-align: center">  Суммарно потрачено {{summa_money}}.</p>


</form>
{% endblock %}

{% block scripts %}
    <script src='/static/js/Chart.js'></script>

<!--     Global parameters:-->
<!--     do not resize the chart canvas when its container does (keep at 600x400px)-->
    <script>
<!--    Chart.defaults.global.responsive = false;-->

<!--    define the chart data-->
    var chartData = {
        labels : [{% for item in labels %}
                    "{{item}}",
                  {% endfor %}],
        datasets : [{
            label: '{{ legend }}',
            fill: true,
            lineTension: 0.1,
<!--            backgroundColor: "rgba(75,192,192,0.4)",-->
            backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850",
            "#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850",
            "#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850",
            "#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850",
            "#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850",
            "#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
            borderColor: "rgba(75,192,192,1)",
            borderCapStyle: 'butt',
            borderDash: [],
            borderDashOffset: 0.0,
            borderJoinStyle: 'miter',
            pointBorderColor: "rgba(75,192,192,1)",
            pointBackgroundColor: "#fff",
            pointBorderWidth: 1,
            pointHoverRadius: 5,
            pointHoverBackgroundColor: "rgba(75,192,192,1)",
            pointHoverBorderColor: "rgba(220,220,220,1)",
            pointHoverBorderWidth: 2,
            pointRadius: 1,
            pointHitRadius: 10,
            data : [
                {% for item in values %}
                    {{item}},
                {% endfor %}
                    ],
            spanGaps: false
        }]
    }

<!--    get chart canvas-->
    var ctx = document.getElementById("myChart").getContext("2d");
    var options =
    {
        scales: {
            x: {
                suggestedMax: 50
            }
        },
    };

<!--    create the chart using the chart canvas-->
    var myChart = new Chart(
        ctx, {
                responsive: false,
                type: 'horizontalBar',
                data: chartData,
                options: options,
             }
        );
</script>

<script>
$(document).ready(function () {
  $('#combobox').on('change', function() {
        document.forms['chart'].submit();
    });
});
</script>

{% endblock %}
