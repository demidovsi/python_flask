{% extends 'base.html' %}

{% block content %}
<link rel="stylesheet" type="text/css" href="/static/css/index.css">
<form method="post" name="history">
    <div id="combobox">
        <p style="font-size:16px; font-weight: bold; color: red;">История расходов за:
            <select id="select_type" name="type_history">
            {% if type_history == "Месяц": %}
                    <option value="Сутки"> Сутки</option>
                    <option value="Месяц" selected> Месяц</option>
                    <option value="Год"> Год</option>
            {% endif %}
            {% if type_history == "Год": %}
                    <option value="Сутки"> Сутки</option>
                    <option value="Месяц"> Месяц</option>
                    <option value="Год" selected> Год</option>
            {% endif %}
            {% if type_history == "Сутки": %}
                    <option value="Сутки" selected> Сутки</option>
                    <option value="Месяц"> Месяц</option>
                    <option value="Год"> Год</option>
            {% endif %}
            </select>
            <button type="submit" class="btn btn-success">Выполнить</button>
        </p>
        <p>
            <button name="left" value="-1"> <img src="/static/left.png" width="18" height="18"> </button>
            {% if type_history == "Сутки": %}
                Дата расходов: <input type="date" id="start" name="dt_start" value="{{st_date}}" required >
            {% endif %}
            {% if type_history == "Месяц": %}
                Месяц:
                <select id="select_name_month" name="select_name_month">
                    {% for month in months: %}
                        {% if month == select_name_month: %}
                            <option value="{{month}}" selected>{{month}}</option>
                        {% else %}
                            <option value="{{month}}">{{month}}</option>
                        {% endif %}
                    {% endfor %}
                </select>
            {% endif %}
            {% if type_history != "Сутки": %}
                Год:
                <input type="number" name="year" min="2015" value="{{year}}">
            {% endif %}

            <button name="right" value="+1"> <img src="/static/right.png" width="18" height="18"> </button>

            {% if type_history == "Месяц": %}
                <button name="current_month" value="current_month"> Текущий месяц </button>
            {% endif %}

            {% if type_history == "Год": %}
                <button name="current_year" value="current_year"> Текущий год </button>
            {% endif %}

            {% if type_history == "Сутки": %}
                <button name="current_day" value="current_day"> Сегодня </button>
            {% endif %}
        </p>
    </div>
    <p style="text-align: center; color: red; font-size:16px; font-weight: bold; ">Расходы за {{type_history}}</p>

    <table id="historyTable" class="table table-striped hover order-column">
        <thead>
            <tr>
                <th scope="col">Дата</th>
                <th scope="col">Расход</th>
                <th scope="col">Категория</th>
                <th scope="col">Комментарий</th>
                <th scope="col">ID</th>
                <th scope="col">Delete</th>
                <th scope="col">Коррекция</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
                <td colspan="3"> Суммарный расход за период= {{moneys}}</td>
<!--                <td colspan="4"> Суммарно покупок={{count_datas}}</td>-->
                <td colspan="4"> </td>
            </tr>
        </tfoot>
        <tbody>
            {% for data in datas %}
                {% if data['id'] %}
                    <tr>
                        <td>{{data['dt']}}</td>
                        <td style="color:green; font-size:16px; font-weight: bold">
                            <div align="right">{{data['money']}}</div>
                        </td>
                        <td><div align="center">{{data['category']}}</div> </td>
                        <td><div align="left">{{data['comment']}}</div> </td>
                        <td><div align="right">{{data['id']}}</div> </td>
                        <td> <div align="center"></div> <input type="checkbox" name="delete{{data['id']}}"> </td>
                        <td> <div align="center"></div> <button name="correct{{data['id']}}">Изменить</button></td>
                    </tr>
                {% endif %}
            {% endfor %}
        </tbody>
    </table>
</form>
{% endblock %}

{% block scripts %}
  <script>
    $(document).ready(function () {

      $('#historyTable').DataTable({
        columns: [
          {orderable: true, searchable: true},
          {orderable: true, searchable: true},
          {orderable: true, searchable: true},
          {orderable: true, searchable: true},
          {orderable: true, searchable: true},
          {orderable: true, searchable: true},
          {orderable: false, searchable: false}
         ],
      });

      $('#combobox').on('change', function() {
            document.forms['history'].submit();
        });

    });
  </script>

{% endblock %}
